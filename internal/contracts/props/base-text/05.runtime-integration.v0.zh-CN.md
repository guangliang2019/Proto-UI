# Props 运行时集成契约（v0）

本文定义 props 在运行时执行层（execute engine + controller API）中的行为契约。

---

## 1. 范围

覆盖：
- hydration 行为（首次 raw 不触发 watcher）
- `controller.applyRawProps(...)` 边界
- raw/resolved watcher 调度顺序
- watcher 回调中的 RunHandle 绑定（PROP-V0-2110）

不覆盖：
- adapter 侧 raw props 生成
- render 调度策略（除明确“不自动 commit”）

---

## 2. Hydration 不触发 Watcher

在 runtime 创建后的首次 raw 应用：
- resolved watchers 不触发
- raw watchers 不触发

---

## 3. Watcher 回调的 RunHandle 绑定（PROP-V0-2110）

在任意 props watcher 回调中，`run` 必须提供：
- `run.props.get()`
- `run.props.getRaw()`
- `run.props.isProvided(key)`

行为一致性：
- resolved watcher 中 `run.props.get()` 与 `next` 行为一致
- raw watcher 中 `run.props.getRaw()` 与 `nextRaw` 行为一致

---

## 4. Watcher 调度顺序

在一次 watcher-firing 的 raw 应用中：
1. raw watchers（rawAll → raw(keys)，保持注册顺序）
2. resolved watchers（watchAll → watch(keys)，保持注册顺序）

---

## 5. applyRawProps 不触发渲染

调用 `controller.applyRawProps(nextRaw)`：
- 允许触发 watcher
- **不得**自动触发 commit/render

渲染只由明确的更新机制触发（如 `run.update()` 或 adapter 触发）。

