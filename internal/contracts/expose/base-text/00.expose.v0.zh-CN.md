# Expose 通路契约（v0）

> Status: Draft – v0
>
> Expose 是 **组件 → App Maker** 的输出信息通路，与 props 相对。
> v0 的 expose 是“注册式输出 API”，不包含订阅/依赖跟踪/自动更新语义。

---

## 0. 范围与非目标

### 0.1 范围（v0）

Expose v0 提供：
- setup 阶段 `def.expose(...)` 注册
- 按 key 稳定映射给 App Maker
- adapter 可按 key 或全量获取 exposes
- 严格的 phase 约束（setup-only）
- 生命周期约束（dispose 后无效）

### 0.2 非目标（v0）

v0 **不**保证：
- 自动更新/订阅语义
- 可序列化或跨生态可移植性
- 运行期修改 expose 映射
- expose 驱动 event/render/state 调度
- 强校验（只做推荐用法）

---

## 1. 术语

- **Expose 通路**：组件 → App Maker 的输出通路
- **Expose key**：注册 expose 的字符串 key
- **Expose value**：注册的值（方法、handle、常量等）
- **Exposes 记录**：adapter 返回的 `Record<string, unknown>`
- **OutputAPI**：Prototype 的泛型 `E`

---

## 2. 类型约定（Prototype 泛型）

- `Prototype<P, E>`：`P` 为 InputAPI（props），`E` 为 OutputAPI（expose）
- v0 仅要求类型层建模，不要求运行时反射 `E`

---

## 3. 定义 API：`def.expose`（setup-only）

### 3.1 形式

```ts
def.expose<K extends keyof E>(key: K, value: E[K]): void
```

### 3.2 规则

1. 仅可在 setup 调用，其他阶段必须抛错
2. `key` 运行时必须为字符串，否则抛错
3. 单实例内同一 `key` 仅可暴露一次，重复抛错
4. expose 为注册式绑定：注册时的 `value` 被存储

> 若需要变化通知，应暴露 state handle 或显式 subscribe API。

---

## 4. App Maker 访问（adapter 责任）

- 允许按 key 读取单个 expose
- 允许读取全量 `Record<string, unknown>`
- key 与 `def.expose` 注册一致

---

## 5. 生命周期

- dispose 后 exposes 无效
- 对已 dispose 实例的读取/调用必须失败或可区分地报错

---

## 6. 推荐用法（informative）

推荐：
- **命令式方法**（`focus` / `reset`）
- **state handle**（配合 expose-state）
- **常量/静态配置**

不推荐：
- 无订阅机制的可变对象

---

## 7. 错误模型（v0）

必须报错：
- setup 外调用 `def.expose`
- 非字符串 key
- 重复 key
- dispose 后访问

建议错误码：
- `EXPOSE_PHASE_VIOLATION`
- `EXPOSE_INVALID_KEY`
- `EXPOSE_DUPLICATE_KEY`
- `EXPOSE_DISPOSED`

---

## 8. 相关契约（非规范）

- props：`internal/contracts/props/*.v0.md`
- expose-state：`internal/contracts/expose/expose-state.v0.md`
- event：`internal/contracts/event/*.v0.md`

